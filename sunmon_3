<script>
    const lat = 47.4079;
    const lon = -53.5272;

    // Fetch sunrise and sunset times
    async function fetchSunTimes() {
        const response = await fetch(`https://api.sunrise-sunset.org/json?lat=${lat}&lng=${lon}&formatted=0`);
        const data = await response.json();

        if (data.status === "OK") {
            const sunrise = new Date(data.results.sunrise);
            const sunset = new Date(data.results.sunset);

            document.getElementById("sunrise").innerHTML = `<i class="fas fa-sun icon"></i> Sunrise: ${sunrise.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
            document.getElementById("sunset").innerHTML = `<i class="fas fa-moon icon"></i> Sunset: ${sunset.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;
        } else {
            document.getElementById("sunrise").textContent = "Error fetching sunrise time";
            document.getElementById("sunset").textContent = "Error fetching sunset time";
        }
    }

    // Fetch Sun and Moon signs, and Moon phase
    async function fetchAstrologyData() {
        const apiKey = "3b82d0b0-d41f-4f17-bb57-a7d72c6db321";
        const apiSecret = "639329b0b11531f93653a5c0fd037b2029b978da1a479160cc665ec5b3f27fff151feaf20aad6314151901ecd637634bb2d7af9481183717af2b84fea1eb09b429478a0f1bd2788192bc0b03417c07f506e94f8897b7e5b9dded5ce8f68e8f7b27eff9fd7262caf3010ea520cffe927a";

        // Get current date
        const currentDate = new Date().toISOString().split("T")[0];

        try {
            // Fetch Sun sign
            const sunResponse = await fetch(`https://api.astronomyapi.com/api/v2/studio/star-chart`, {
                method: "POST",
                headers: {
                    "Authorization": `Basic ${btoa(apiKey + ":" + apiSecret)}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "latitude": lat,
                    "longitude": lon,
                    "elevation": 0,
                    "date": currentDate,
                    "language": "en"
                })
            });
            const sunData = await sunResponse.json();
            const sunSign = sunData.data.position.constellation.name;

            // Fetch Moon sign and Moon phase
            const moonResponse = await fetch(`https://api.astronomyapi.com/api/v2/studio/moon-phase`, {
                method: "POST",
                headers: {
                    "Authorization": `Basic ${btoa(apiKey + ":" + apiSecret)}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "latitude": lat,
                    "longitude": lon,
                    "elevation": 0,
                    "date": currentDate,
                    "language": "en"
                })
            });
            const moonData = await moonResponse.json();
            const moonSign = moonData.data.position.constellation.name;
            const moonPhase = moonData.data.phase.name;

            // Update widget with fetched data
            document.getElementById("sun-sign").innerHTML = `<i class="fas fa-star icon"></i> Sun in: ${sunSign}`;
            document.getElementById("moon-sign").innerHTML = `<i class="fas fa-moon icon"></i> Moon in: ${moonSign}`;
            document.getElementById("moon-phase").innerHTML = `<i class="fas fa-circle icon"></i> Moon phase: ${moonPhase}`;
            document.getElementById("current-date").textContent = new Date().toDateString();

        } catch (error) {
            console.error("Error fetching astrology data:", error);
            document.getElementById("sun-sign").textContent = "Error fetching Sun sign";
            document.getElementById("moon-sign").textContent = "Error fetching Moon sign";
            document.getElementById("moon-phase").textContent = "Error fetching Moon phase";
        }
    }

    // Initial function calls
    fetchSunTimes();
    fetchAstrologyData();
</script>
